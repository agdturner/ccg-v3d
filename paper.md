---
title: 'Development of a Modularised Java library for 3D Euclidean geometry'
tags:
  - Java
  - Euclidean geometry
  - 3D
  - arbitrary precision
  - order of magnitude
authors:
  - name: Andy Turner^[corresponding author]
    orcid: 0000-0002-6098-6313
    affiliation: 1
affiliations:
 - name: CCG, School of Geography, University of Leeds
 - index: 1
date: 30 October 2021
bibliography: paper.bib
---

# Summary

This paper introduces [ccg-v3d](https://github.com/agdturner/ccg-v3d) - a three-dimensional ([3D](https://en.wikipedia.org/wiki/Euclidean_space)) [Euclidean geometry](https://en.wikipedia.org/wiki/Euclidean_geometry) library. It is pure modularised Java, based on [openJDK 17](https://openjdk.java.net/projects/jdk/17/). The only additional dependency is [@ccg-math] - a stand alone mathematics library.

Point locations in space are defined using 3D [cartesian](https://en.wikipedia.org/wiki/Cartesian_coordinate_system) coordinates with [orthogonal](https://en.wikipedia.org/wiki/Orthogonality) X, Y and Z axes that meet at the origin - a point <x,y,z> where x=y=z=0. The coordinate system is "right handed", so if X increases to the right of this page, Y increases towards the top of this page, then Z increases out from the page, (see [orientation](https://en.wikipedia.org/wiki/Orientation_(vector_space)) for details of handedness). Coordinates are either stored as [Math_BigRational](https://github.com/agdturner/ccg-math/blob/master/src/main/java/uk/ac/leeds/ccg/math/number/Math_BigRational.java) numbers - a subset of [rational numbers](https://en.wikipedia.org/wiki/Rational_number) with java.math.BigDecimal numerators and denominators, or [Math_BigRationalSqrt](https://github.com/agdturner/ccg-math/blob/master/src/main/java/uk/ac/leeds/ccg/math/number/Math_BigRationalSqrt.java) - that also represent square roots (calculated to a given [Order of Magnitude](https://en.wikipedia.org/wiki/Order_of_magnitude) precision as required).

More light weight geometries are in the [uk.ac.leeds.ccg.v3d.geometry.light](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/light/) package. These use [V3D_V](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/light/V3D_V.java) which have three Math_BigRational components (nominally x, y and z) and extend [V3D_VGeometry](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/light/V3D_VGeometry.java) - an abstract class that holds a V3D_V "offset" which can be thought of as the translation of the [centroid](https://en.wikipedia.org/wiki/Centroid) of the geometry from the origin.
- [V3D_VPoint](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/light/V3D_VPoint.java) - is for representing points. A V3D_V instance gives the location of the point relative to the offset.
- [V3D_VLine](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/light/V3D_VLine.java) - for representing finite lines. V3D_V instances p and q give the location of the ends of the line relative to the offset (and can be the same).
- [V3D_VTriangle](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/light/V3D_VTriangle.java) - for representing triangles. V3D_V instances p, q and r give the location of each corner of the triangle relative to the offset (two or more of them can be the same).
- [V3D_VTetrahedron](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/light/V3D_VTetrahedron.java) - for representing [tetrahedron](https://en.wikipedia.org/wiki/Tetrahedron). V3D_V instances p, q, r and s give the location of each corner of the tetrahedron relative to the offset (two or more can be the same).

Heavier geometries use offsets and relative locations stored as [Math_BigRationalSqrt](https://github.com/agdturner/ccg-math/blob/master/src/main/java/uk/ac/leeds/ccg/math/number/Math_BigRationalSqrt.java) numbers. This allows for example a point to be located at x=sqrt(2), y=sqrt(2), z=sqrt(2). For these geometries there are methods which test for intersection, that return the geometry of the intersection, and that calculate the minimum distance. The methods that test if two geometries intersect involve no rounding, but calculating geometries of intersection may involve rounding as coordinates are only a subset of [algebraic number](https://en.wikipedia.org/wiki/Algebraic_number), so finite geometries store the [Order of Magnitude](https://en.wikipedia.org/wiki/Order_of_magnitude) used to calculate magnitudes to be clear about the precision.

For any finite ccg-v3d geometry, a [V3D_Envelope](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Envelope.java) - a [rectangular cuboid](https://en.wikipedia.org/wiki/Rectangular_cubiod) aligned with the axes can be computed. Such envelopes assist in computations that test for intersection of a large number of geometries many of which do not intersect. This works by quickly ruling out intersection between geometries that are in different parts of the X, Y, Z domain.

[V3D_Geometry](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Geometry.java) is an abstract class with a V3D_Vector offset, and an [Order of Magnitude](https://en.wikipedia.org/wiki/Order_of_magnitude#Uses) (OOM). Similar to V3D_V, this allows geometries to be translated and rotated about the origin. V3D_Geometry is extended to define the following:
- [V3D_Point](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Point.java) - a point geometry where a V3D_Vector gives the position relative to the offset.
- [V3D_Line](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Line.java) - an infinite line geometry that passes through two defined points.
- [V3D_Ray](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Ray.java) - an infinite line geometry that extends from a point in one direction through another point.
- [V3D_Plane](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Plane.java) - an infinite [plane geometry](https://en.wikipedia.org/wiki/Plane_(geometry)). The plane is defined either by 3 points (p, q and r) that are not [collinear](https://en.wikipedia.org/wiki/Collinearity) or coincident, or by a normal vector and a point (where all points orthogonal to the normal vector at the point are on the plane).
- [V3D_LineSegment](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_LineSegment.java) - represents a single continuous finite part of a line. Line segments are considered equal irrespective of the order of the end points. The centroid of a line segment can be computed and stored.
- [V3D_Triangle](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Triangle.java) - a triangular part of a plane. The three coplanar points {p, q and r} are the corners of the triangle. Triangle sides can be stored as line segments. The centroid of a triangle can be computed and stored.
- [V3D_Tetrahedron](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Tetrahedron.java) - represents a [tetrahedron](https://en.wikipedia.org/wiki/Tetrahedron). Any selection of three points are not coplanar with the fourth. A tetrahedron surface can be thought of as compising of four triangles. The [centroid](https://en.wikipedia.org/wiki/Centroid#Of_a_tetrahedron_and_n-dimensional_simplex) and the [volume](https://en.wikipedia.org/wiki/Tetrahedron#Volume) can be computed and stored.

Geometry collections of the same types of geometry are being supported, including:
- [V3D_Points](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Points.java) - for collections of points.
- [V3D_LineSegments](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_LineSegments.java) - for collections of collinear line segments. 
- [V3D_Triangles](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Triangles.java) - for collections of coplanar triangles. 
- [V3D_Tetrahedrons](https://github.com/agdturner/ccg-v3d/blob/master/src/main/java/uk/ac/leeds/ccg/v3d/geometry/V3D_Tetrahedrons.java) - for collections of tetrahedrons.

# Statement of need
The library provides robust intersection test methods for [simplex](https://en.wikipedia.org/wiki/Simplexes)s in 3D (currently with the exception of [tetrahedra](https://en.wikipedia.org/wiki/Tetrahedra)).

The developer is using the library to visualise global scale geographical data and to develop models of [Earth](https://en.wikipedia.org/wiki/Earth) and parts of it. Link to example.

Everything is moving and changing at rates that vary with scale. Exploring patterns of change in different things in regions across ranges of spatial and temporal scales using data at defined spatial and temporal resolutions is common in science. The [structure of Earth](https://en.wikipedia.org/wiki/Structure_of_Earth), whilst conceptually well defined, is continually changing as Earth moves under inertia through the cosmos along with the [Sun](https://en.wikipedia.org/wiki/Sun), the [Moon](https://en.wikipedia.org/wiki/Moon) and other solar system [astronomical object](https://en.wikipedia.org/wiki/Astronomical_object)s. Earth's atmosphere expands as it heats in the day and shrinks as it cools in the night. On the surface, rock and ice form and move in complex ways under the influence of the change in the seasons caused by the tilt of Earth's axis of rotation. Understanding the nature of large ice sheets and glaciers could be particularly important for the future of the current and next few generations of humanity. Better tools are needed to map the Earth and to model and understand Earth's atmospheric, surface, subsurface, crust, mantle and core processes better. Whilst gases and liquids often lack structure and have fuzzier boudaries and the geometrical delineations are harder to determine, so much of the world is made of more solid more slowly changing parts which have clearer shapes and volumes that can be usefully mapped with sets of point, with surface representing triangular irregular networks, and volume representing collections of tetrahedron.

The orbit of the Earth around the Sun is complicated by the gravitational pull of other planets. The distance between the Earth and the Sun varies through time as they both orbit around the centre of mass of the system. [Orbital eccentricity](https://en.wikipedia.org/wiki/Orbital_eccentricity) affects Earth surface processes and probably causes changes deep within the Earth as it does on moons orbiting close around the large planets such as [Io](https://en.wikipedia.org/wiki/Io_(moon)). Earth currently has a very circular orbit, but how well do we understand how this is changing? At another scale, it is thought that our solar system has a [helicoid](https://en.wikipedia.org/wiki/Helicoid) like motion as it traverses the [Milky Way](https://en.wikipedia.org/wiki/Milky_Way). How much does our position relative to the [galactic plane](https://en.wikipedia.org/wiki/Galactic_plane) vary and what effects might this have? [Earth's magnetic field](https://en.wikipedia.org/wiki/Earth%27s_magnetic_field) is known to vary and flip, but how does this happen and can it be better predicted? The gravity of the sun and the moon affect sea levels significantly on, but how good are our best estimates of sea levels in the next 50 to 100 years? Are current technology and models built based on [floating point](https://en.wikipedia.org/wiki/Floating_point) numbers providing sufficient accuracy?  Ocean boundaries change, water density changes with pressure, temperature and state. Ice supported on land that melts away and adds to the volume of the oceans and seas. The total amount of ice is small relative to the total volume of water in the oceans which again is small relative to the mass of Earth. Application of this code abounds in [Earth Science](https://en.wikipedia.org/wiki/Earth_science)s which was one of the original motivations for developing it.

The library might also be useful in studying shapes and changes in structure over time across a large range of scales and have diverse practical application in telecommunications, transportation, architecture, engineering, biology and [classical mechanics](https://en.wikipedia.org/wiki/Classical_mechanics). For modern chemistry and physics representing space as having three dimensions and tracking changes in this through time represented as a distinct fourth dimension is now commonly insufficent. It is well reasoned that double the [dimension](https://en.wikipedia.org/wiki/Dimension_(vector_space))s of [4D](https://en.wikipedia.org/wiki/Four-dimensional_space) are wanted and that the use of [octonions](https://en.wikipedia.org/wiki/Octonion) is useful in developing our understanding of the fabric of reality [@furey-space]. It may be that some of the code developed for this library might be useful for developing a library that works in higher dimensions.

It may be that users would like methods to identify geometries that merely touch and ones that overlap. If the library development is to be user/developer driven, then some kind of list of feature requests and a roadmap for developing the functionality is wanted. Perhpas though [Apache Commons Geometry](https://commons.apache.org/proper/commons-geometry/) (see also: [Apache Commons Geometry GitHub Repository](https://github.com/apache/commons-geometry)) is the place for that. This parallel development appears to be developing similar arbitrary precision geometrical functionality.

# Acknowledgements
The [University of Leeds](http://www.leeds.ac.uk) supported the development of the software. Externally funded research grants supported the development of some of the dependencies. The library is based on [@big-math] and in particular [BigRational](https://github.com/eobermuhlner/big-math/blob/master/ch.obermuhlner.math.big/src/main/java/ch/obermuhlner/math/big/BigRational.java).

# References
